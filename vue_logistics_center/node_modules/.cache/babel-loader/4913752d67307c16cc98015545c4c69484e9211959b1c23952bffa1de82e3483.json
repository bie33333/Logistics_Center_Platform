{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { getMemberAllInfo, selectCardByMemberId, exchange } from \"@/api/member\";\nimport { consume, recharge } from \"@/api/card\";\nimport { selectAllMovie } from \"@/api/dashboard\";\nimport { selectAllGood } from \"@/api/good\";\nimport Head from './Head.vue';\nimport ConsumeDialog from \"../page/card/ConsumeDialog.vue\";\nimport RechargeDialog from \"../page/card/RechargeDialog.vue\";\nimport ExchangeDialog from \"../page/member/ExchangeDialog.vue\";\nexport default {\n  components: {\n    Head,\n    ExchangeDialog,\n    RechargeDialog,\n    ConsumeDialog\n  },\n  data() {\n    return {\n      member: {\n        name: localStorage.getItem('memberId')\n      },\n      cardData: [],\n      movieData: [],\n      page1: {\n        index: 1,\n        size: 4,\n        total: 0\n      },\n      goodData: [],\n      page2: {\n        index: 1,\n        size: 4,\n        total: 0\n      }\n    };\n  },\n  created() {\n    this.getMemberData();\n    this.getMovieData();\n    this.getGoodData();\n  },\n  mounted() {\n    this.$refs.consume.$on('ConsumeDialogConfirm', form => {\n      consume(form).then(res => {\n        if (res.status == 200) {\n          this.$message.success('消费成功');\n          this.getMemberData();\n        } else {\n          this.$message.error(\"消费失败，服务器出现故障\");\n        }\n      });\n    });\n    this.$refs.recharge.$on('RechargeDialogConfirm', form => {\n      recharge(form).then(res => {\n        if (res.status == 200) {\n          this.$message.success('充值成功');\n          this.getMemberData();\n        } else {\n          this.$message.error(\"充值失败，服务器出现故障\");\n        }\n      });\n    });\n    this.$refs.exchange.$on(\"ExchangeDialogConfirm\", form => {\n      exchange(form).then(res => {\n        if (res.status == 200) {\n          this.$message.success(`兑换成功`);\n          this.getMemberData();\n        } else {\n          this.$message.success(`兑换失败，服务端出现问题`);\n        }\n      });\n    });\n  },\n  methods: {\n    getMemberData() {\n      getMemberAllInfo(this.member).then(res => {\n        this.member = res.data;\n        this.getCardData();\n      });\n    },\n    getCardData() {\n      selectCardByMemberId(this.member).then(res => {\n        this.cardData = res.data.list;\n      });\n    },\n    handleRecharge(row) {\n      this.$refs.recharge.show(row);\n    },\n    handleConsume(row) {\n      this.$refs.consume.show(row);\n    },\n    getMovieData() {\n      selectAllMovie({\n        \"pageIndex\": this.page1.index,\n        \"pageSize\": this.page1.size\n      }).then(res => {\n        this.movieData = res.data.list;\n        this.page1.total = res.data.pageTotal;\n      });\n    },\n    handlePageChange(val) {\n      this.page1.index = val;\n      this.getMovieData();\n    },\n    getGoodData() {\n      selectAllGood({\n        pageIndex: this.page2.index,\n        pageSize: this.page2.size\n      }).then(res => {\n        this.goodData = res.data.list;\n        this.page2.total = res.data.pageTotal;\n      });\n    },\n    handlePage2Change(val) {\n      this.page2.index = val;\n      this.getGoodData();\n    },\n    handleExchange() {\n      this.$refs.exchange.show(this.member);\n    },\n    handleCommand(command) {\n      if (command == 'loginOut') {\n        localStorage.removeItem('memberId');\n        this.$router.push('/login');\n      }\n    }\n  }\n};","map":{"version":3,"names":["getMemberAllInfo","selectCardByMemberId","exchange","consume","recharge","selectAllMovie","selectAllGood","Head","ConsumeDialog","RechargeDialog","ExchangeDialog","components","data","member","name","localStorage","getItem","cardData","movieData","page1","index","size","total","goodData","page2","created","getMemberData","getMovieData","getGoodData","mounted","$refs","$on","form","then","res","status","$message","success","error","methods","getCardData","list","handleRecharge","row","show","handleConsume","pageTotal","handlePageChange","val","pageIndex","pageSize","handlePage2Change","handleExchange","handleCommand","command","removeItem","$router","push"],"sources":["src/components/common/MemberView.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <div class=\"header\">\r\n            <div class=\"MemberLogo\">电影院会员系统</div>\r\n            <div class=\"header-right\">\r\n                <div class=\"user-avatar\">\r\n                    <img src=\"@/assets/img/admin.png\"/>\r\n                </div>\r\n                <el-dropdown class=\"user-name\" trigger=\"click\" @command=\"handleCommand\">\r\n                    <span class=\"dropdown-link\">{{ id }}<i class=\"el-icon-caret-bottom\"></i></span>\r\n                    <el-dropdown-menu slot=\"dropdown\"><el-dropdown-item divided command=\"loginOut\">退出登录</el-dropdown-item></el-dropdown-menu>\r\n                </el-dropdown>\r\n            </div>\r\n        </div>\r\n        <div class=\"memberBody\">\r\n            <el-row :gutter=\"25\">\r\n                <el-col :span=\"14\">\r\n                    <el-row :gutter=\"20\" class=\"mgb20\">\r\n                        <el-card shadow=\"hover\" style=\"height:252px;\">\r\n                            <div class=\"user-info\">\r\n                                <img src=\"@/assets/img/admin.png\" class=\"manager-avatar\" alt/>\r\n                                <div class=\"user-info-cont\">\r\n                                    <div class=\"user-info-name\">{{member.name}}</div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"user-info-list\">会员ID<span>{{member.memberId}}</span></div>\r\n                            <div class=\"user-info-list\">拥有的积分<span>{{member.integral}}</span></div>\r\n                        </el-card>\r\n                    </el-row>\r\n                    <el-row :gutter=\"20\" class=\"mgb20\">\r\n                        <el-card>\r\n                            <div slot=\"header\">\r\n                                <div style=\"font-size: 20px; line-height: 30px\">我的会员卡</div>\r\n                            </div>\r\n                            <el-table :data=\"cardData\" border class=\"table\">\r\n                                <el-table-column prop=\"cardId\" label=\"ID\" width=\"200\" align=\"center\"></el-table-column>\r\n                                <el-table-column prop=\"grade\" label=\"等级\" align=\"center\"></el-table-column>\r\n                                <el-table-column prop=\"balance\" label=\"余额\" align=\"center\">\r\n                                    <template slot-scope=\"scope\">￥{{scope.row.balance}}</template>\r\n                                </el-table-column>\r\n                                <el-table-column prop=\"lose\" label=\"状态\" align=\"center\">\r\n                                    <template slot-scope=\"scope\">\r\n                                        <el-tag :type=\"scope.row.lose===0?'success':'danger'\" >\r\n                                            {{scope.row.lose===0?'正常':'挂失'}}\r\n                                        </el-tag></template>\r\n                                </el-table-column>\r\n                                <el-table-column label=\"操作\" width=\"200px\" align=\"center\">\r\n                                    <template slot-scope=\"scope\">\r\n                                        <el-button type=\"primary\" v-if=\"scope.row.lose===0\" @click=\"handleRecharge(scope.row)\">充值</el-button>\r\n                                        <el-button type=\"primary\" v-if=\"scope.row.lose===0\" :disabled=\"scope.row.balance == 0\" @click=\"handleConsume(scope.row)\">消费</el-button>\r\n                                    </template>\r\n                                </el-table-column>\r\n                            </el-table>\r\n                        </el-card>\r\n                    </el-row>\r\n                    \r\n                </el-col>\r\n                <el-col :span=\"10\">\r\n                    <el-row :gutter=\"20\" class=\"mgb20\">\r\n                        <el-card style=\"height:200px;\">\r\n                            <div slot=\"header\">\r\n                                <div style=\"font-size: 20px; line-height: 30px\"><i class=\"el-icon-user\"></i>  讯息</div>\r\n                            </div>\r\n                            <span>{{ member.info }}</span>\r\n                        </el-card>\r\n                    </el-row>\r\n                    <el-row :gutter=\"20\" class=\"mgb20\">\r\n                        <el-card style=\"height:400px;\">\r\n                            <div style=\"font-size: 20px; line-height: 30px\" slot=\"header\">电影列表</div>\r\n                            <el-table class=\"table\" border :data=\"movieData\">\r\n                                <el-table-column prop=\"name\" label=\"电影名\"></el-table-column>\r\n                                <el-table-column prop=\"price\" label=\"价格\" width=\"55\"></el-table-column>\r\n                                <el-table-column prop=\"time\" label=\"时间\"></el-table-column>\r\n                                <el-table-column prop=\"integral\" label=\"积分\" width=\"55\"></el-table-column>\r\n                            </el-table>\r\n                            <el-pagination class=\"pagination\" background layout=\"total, prev, pager, next\"\r\n                                :current-page=\"page1.index\" :page-size=\"page1.size\" :total=\"page1.total\"\r\n                                @current-change=\"handlePageChange\">\r\n                            </el-pagination>\r\n                        </el-card>\r\n                    </el-row>\r\n                    <el-row :gutter=\"20\" class=\"mgb20\">\r\n                        <el-card shadow=\"hover\">\r\n                            <div slot=\"header\">\r\n                                <div style=\"font-size: 20px; line-height: 30px\">商品\r\n                                    <el-button type=\"primary\" @click=\"handleExchange\">兑换</el-button>\r\n                                </div>\r\n                            </div>\r\n                            <el-table :data=\"goodData\" border class=\"table\">\r\n                                <el-table-column prop=\"name\" label=\"name\" align=\"center\"></el-table-column>\r\n                                <el-table-column prop=\"integral\" label=\"积分\" align=\"center\"></el-table-column>\r\n                                <el-table-column prop=\"stock\" label=\"存量\" align=\"center\"></el-table-column>\r\n                            </el-table>\r\n                            <el-pagination class=\"pagination\" background layout=\"total, prev, pager, next\" @current-change=\"handlePage2Change\" \r\n                                :current-page=\"page2.index\" :page-size=\"page2.size\" :total=\"page2.total\">\r\n                            </el-pagination>\r\n                        </el-card>\r\n                    </el-row>\r\n                </el-col>\r\n            </el-row>\r\n        </div>\r\n        \r\n        <consume-dialog ref=\"consume\"></consume-dialog>\r\n        <recharge-dialog ref=\"recharge\"></recharge-dialog>\r\n        <exchange-dialog ref=\"exchange\"></exchange-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { getMemberAllInfo, selectCardByMemberId, exchange } from \"@/api/member\";\r\nimport { consume, recharge } from \"@/api/card\";\r\nimport { selectAllMovie } from \"@/api/dashboard\";\r\nimport { selectAllGood } from \"@/api/good\";\r\nimport Head from './Head.vue';\r\nimport ConsumeDialog from \"../page/card/ConsumeDialog.vue\";\r\nimport RechargeDialog from \"../page/card/RechargeDialog.vue\";\r\nimport ExchangeDialog from \"../page/member/ExchangeDialog.vue\";\r\nexport default {\r\n    components: { Head, ExchangeDialog, RechargeDialog, ConsumeDialog },\r\n    data() {\r\n        return {\r\n            member: {\r\n                name: localStorage.getItem('memberId'),\r\n            },\r\n            cardData: [],\r\n            movieData: [],\r\n            page1: {\r\n                index: 1,\r\n                size: 4,\r\n                total: 0,\r\n            },\r\n            goodData: [],\r\n            page2: {\r\n                index: 1,\r\n                size: 4,\r\n                total: 0,\r\n            },\r\n        }\r\n    },\r\n    created() {\r\n        this.getMemberData();\r\n        this.getMovieData();\r\n        this.getGoodData();\r\n    },\r\n    mounted(){\r\n        this.$refs.consume.$on('ConsumeDialogConfirm', form => {\r\n            consume(form).then(res=>{\r\n                if(res.status==200){\r\n                    this.$message.success('消费成功');\r\n                    this.getMemberData();\r\n                }else{\r\n                    this.$message.error(\"消费失败，服务器出现故障\")\r\n                }\r\n            })\r\n        });\r\n        this.$refs.recharge.$on('RechargeDialogConfirm', form => {\r\n            recharge(form).then(res=>{\r\n                if(res.status==200){\r\n                    this.$message.success('充值成功');\r\n                    this.getMemberData();\r\n                }else{\r\n                    this.$message.error(\"充值失败，服务器出现故障\")\r\n                }\r\n            })\r\n        });\r\n        this.$refs.exchange.$on(\"ExchangeDialogConfirm\", form=>{\r\n            exchange(form).then(res=>{\r\n                if(res.status==200) {\r\n                    this.$message.success(`兑换成功`);\r\n                    this.getMemberData();\r\n                }else{\r\n                    this.$message.success(`兑换失败，服务端出现问题`);\r\n                }\r\n            });\r\n        })\r\n    },\r\n    methods: {\r\n        getMemberData() {\r\n            getMemberAllInfo(this.member).then(res=>{\r\n                this.member = res.data;\r\n                this.getCardData();\r\n            })\r\n        },\r\n        getCardData(){\r\n            selectCardByMemberId(this.member).then(res=>{\r\n                this.cardData = res.data.list;\r\n            })\r\n        },\r\n        handleRecharge(row){\r\n            this.$refs.recharge.show(row);\r\n        },\r\n        handleConsume(row){\r\n            this.$refs.consume.show(row);\r\n        },\r\n        getMovieData() {\r\n            selectAllMovie  ({\r\n                \"pageIndex\" : this.page1.index,\r\n                \"pageSize\" : this.page1.size\r\n            }).then(res => {\r\n                this.movieData = res.data.list;\r\n                this.page1.total = res.data.pageTotal;\r\n            })\r\n        },\r\n        handlePageChange(val) {\r\n            this.page1.index = val;\r\n            this.getMovieData();\r\n        },\r\n        getGoodData(){\r\n            selectAllGood({\r\n                pageIndex: this.page2.index,\r\n                pageSize: this.page2.size,\r\n            }).then(res => {\r\n                this.goodData = res.data.list;\r\n                this.page2.total = res.data.pageTotal;\r\n            })\r\n        },\r\n        handlePage2Change(val) {\r\n            this.page2.index = val;\r\n            this.getGoodData();\r\n        },\r\n        handleExchange(){\r\n            this.$refs.exchange.show(this.member);\r\n        },\r\n        handleCommand(command) {\r\n            if (command == 'loginOut') {\r\n                localStorage.removeItem('memberId');\r\n                this.$router.push('/login');\r\n            }\r\n        },\r\n    }\r\n}\r\n</script>\r\n\r\n<style>\r\n.memberBody{\r\n    margin-left: 10px;\r\n    margin-right: 10px;\r\n}\r\n.header {\r\n    position: relative;\r\n\r\n    margin: 0;\r\n    padding: 0;\r\n    box-sizing: border-box;\r\n    width: 100%;\r\n    height: 70px;\r\n    line-height: 70px;\r\n\r\n    background-color: #242f42;\r\n    font-size: 22px;\r\n    color: #fff;\r\n}\r\n\r\n.collapse-btn {\r\n    float: left;\r\n    padding: 0 21px;\r\n    cursor: pointer;\r\n}\r\n\r\n.MemberLogo {\r\n    float: left;\r\n    width: 250px;\r\n    padding-left: 30px;\r\n}\r\n\r\n.header-right {\r\n    float: right;\r\n    padding-right: 50px;\r\n    display: flex;\r\n    align-items: center;\r\n}\r\n\r\n.user-name {\r\n    margin-left: 10px;\r\n}\r\n\r\n.user-avatar {\r\n    margin-left: 20px;\r\n}\r\n\r\n.user-avatar img {\r\n    display: block;\r\n    width: 40px;\r\n    height: 40px;\r\n    border-radius: 50%;\r\n}\r\n\r\n.dropdown-link {\r\n    color: #fff;\r\n    font-size: 18px;\r\n    cursor: pointer;\r\n}\r\n\r\n\r\n.user-info {\r\n    display: flex;\r\n    align-items: center;\r\n    padding-bottom: 20px;\r\n    border-bottom: 2px solid #ccc;\r\n    margin-bottom: 20px;\r\n}\r\n \r\n.manager-avatar {\r\n    width: 120px;\r\n    height: 120px;\r\n    border-radius: 50%;\r\n}\r\n\r\n.user-info-cont {\r\n    padding-left: 50px;\r\n    flex: 1;\r\n    font-size: 14px;\r\n    color: #999;\r\n}\r\n\r\n.user-info-cont div:first-child {\r\n    font-size: 30px;\r\n    color: #222;\r\n}\r\n\r\n.user-info-list {\r\n    font-size: 14px;\r\n    color: #999;\r\n    line-height: 25px;\r\n}\r\n\r\n.user-info-list span {\r\n    margin-left: 70px;\r\n}\r\n.mgb20 {\r\n    margin-bottom: 20px;\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}