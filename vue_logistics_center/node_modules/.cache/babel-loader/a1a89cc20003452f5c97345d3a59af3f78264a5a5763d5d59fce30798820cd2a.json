{"ast":null,"code":"import { selectAllCard, selectCardByCondition, recharge, consume, cardCancel, cardLose } from \"@/api/card.js\";\nimport ConsumeDialog from './card/ConsumeDialog.vue';\nimport RechargeDialog from './card/RechargeDialog.vue';\nexport default {\n  components: {\n    ConsumeDialog,\n    RechargeDialog\n  },\n  data() {\n    return {\n      cardData: [],\n      page: {\n        index: 1,\n        size: 5,\n        total: 0\n      },\n      condition: {\n        nameId: \"\",\n        name: \"\",\n        cardId: \"\"\n      }\n    };\n  },\n  created() {\n    this.getCardData();\n  },\n  mounted() {\n    this.$refs.consume.$on('ConsumeDialogConfirm', form => {\n      consume(form).then(res => {\n        if (res.status == 200) {\n          this.$message.success('挂失成功');\n          this.getCardData();\n        } else {\n          this.$message.error(\"挂失失败，服务器出现故障\");\n        }\n      });\n    });\n    this.$refs.recharge.$on('RechargeDialogConfirm', form => {\n      recharge(form).then(res => {\n        this.handleSearch();\n      });\n    });\n  },\n  methods: {\n    getCardData() {\n      selectAllCard({\n        pageIndex: this.page.index,\n        pageSize: this.page.size\n      }).then(res => {\n        this.cardData = res.data.list;\n        this.page.total = res.data.pageTotal;\n      });\n    },\n    handlePageChange(val) {\n      this.page.index = val;\n      this.handleSearch();\n    },\n    handleSearch() {\n      selectCardByCondition({\n        pageIndex: this.page.index,\n        pageSize: this.page.size,\n        memberId: this.condition.memberId,\n        name: this.condition.name,\n        cardId: this.condition.cardId\n      }).then(res => {\n        this.cardData = res.data.list;\n        this.page.total = res.data.pageTotal;\n      });\n    },\n    handleRecharge(row) {\n      this.$refs.recharge.show(row);\n    },\n    handleConsume(row) {\n      this.$refs.consume.show(row);\n    },\n    handleLose(row) {\n      this.$confirm('确定要挂失吗？', '提示', {\n        type: 'warning'\n      }).then(() => {\n        cardLose(row).then(res => {\n          if (res.status == 200) {\n            this.$message.success('挂失成功');\n            this.getCardData();\n          } else {\n            this.$message.error(\"挂失失败，服务器出现故障\");\n          }\n        });\n      }).catch(() => {});\n    },\n    handleCancel(row) {\n      this.$confirm('确定要解挂吗？', '提示', {\n        type: 'warning'\n      }).then(() => {\n        cardCancel(row).then(res => {\n          if (res.status == 200) {\n            this.$message.success('解挂成功');\n            this.getCardData();\n          } else {\n            this.$message.error(\"解挂失败，服务器出现故障\");\n          }\n        });\n      }).catch(() => {});\n    },\n    handleReissue(row) {\n      this.$confirm('确定要补卡吗？', '提示', {\n        type: 'warning'\n      }).then(() => {\n        console.log(index);\n        console.log(row);\n      }).catch(() => {});\n    }\n  }\n};","map":{"version":3,"names":["selectAllCard","selectCardByCondition","recharge","consume","cardCancel","cardLose","ConsumeDialog","RechargeDialog","components","data","cardData","page","index","size","total","condition","nameId","name","cardId","created","getCardData","mounted","$refs","$on","form","then","res","status","$message","success","error","handleSearch","methods","pageIndex","pageSize","list","pageTotal","handlePageChange","val","memberId","handleRecharge","row","show","handleConsume","handleLose","$confirm","type","catch","handleCancel","handleReissue","console","log"],"sources":["src/components/page/Card.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <el-card shadow=\"hover\">\r\n            <div slot=\"header\">\r\n                <div style=\"font-size: 20px; line-height: 30px\"><i class=\"el-icon-user\"></i> 会员卡列表</div>\r\n                <el-input v-model=\"condition.memberId\" clearable placeholder=\"会员ID查询\" class=\"handle-input mr10\"></el-input>\r\n                <el-input v-model=\"condition.name\" clearable placeholder=\"会员名称查询\" class=\"handle-input mr10\"></el-input>\r\n                <el-input v-model=\"condition.cardId\" clearable placeholder=\"cadId查询\" class=\"handle-input mr10\"></el-input>\r\n                <el-button type=\"primary\" icon=\"el-icon-search\" @click=\"handleSearch\">查询</el-button>\r\n            </div>\r\n            <el-table :data=\"cardData\" border class=\"table\" @selection-change=\"handleSelectionChange\">\r\n                <el-table-column prop=\"cardId\" label=\"ID\" width=\"180\" align=\"center\"></el-table-column>\r\n                <el-table-column prop=\"grade\" label=\"等级\" width=\"180\" align=\"center\"></el-table-column>\r\n                <el-table-column prop=\"name\" label=\"会员\" align=\"center\"></el-table-column>\r\n                <el-table-column prop=\"balance\" label=\"余额\" align=\"center\">\r\n                    <template slot-scope=\"scope\">￥{{scope.row.balance}}</template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"lose\" label=\"状态\" align=\"center\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-tag :type=\"scope.row.lose===0?'success':'danger'\" >\r\n                            {{scope.row.lose===0?'正常':'挂失'}}\r\n                        </el-tag></template>\r\n                </el-table-column>\r\n                <el-table-column label=\"操作\" width=\"500px\" align=\"center\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button type=\"primary\" v-if=\"scope.row.lose===0\" @click=\"handleRecharge(scope.row)\">充值</el-button>\r\n                        <el-button type=\"primary\" v-if=\"scope.row.lose===0\" :disabled=\"scope.row.balance == 0\" @click=\"handleConsume(scope.row)\">消费</el-button>\r\n                        <el-button type=\"warning\" v-if=\"scope.row.lose===0\" @click=\"handleLose(scope.row)\">挂失</el-button>\r\n                        <el-button type=\"danger\" v-if=\"scope.row.lose===1\" @click=\"handleCancel(scope.row)\">解挂</el-button>\r\n                        <!-- <el-button type=\"danger\" v-if=\"scope.row.lose===1\" @click=\"handleReissue(scope.row)\">补卡</el-button> -->\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n            <el-pagination class=\"pagination\" background layout=\"total, prev, pager, next\" @current-change=\"handlePageChange\" \r\n                :current-page=\"page.index\" :page-size=\"page.size\" :total=\"page.total\">\r\n            </el-pagination>\r\n\r\n            <consume-dialog ref=\"consume\"></consume-dialog>\r\n            <recharge-dialog ref=\"recharge\"></recharge-dialog>\r\n        </el-card>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { selectAllCard, selectCardByCondition, recharge, consume, cardCancel, cardLose } from \"@/api/card.js\";\r\nimport ConsumeDialog from './card/ConsumeDialog.vue';\r\nimport RechargeDialog from './card/RechargeDialog.vue';\r\nexport default {\r\n    components: {ConsumeDialog, RechargeDialog},\r\n    data() {\r\n        return {\r\n            cardData: [],\r\n            page: {\r\n                index: 1,\r\n                size: 5,\r\n                total: 0,\r\n            },\r\n            condition: {\r\n                nameId: \"\",\r\n                name: \"\",\r\n                cardId: \"\",\r\n            }\r\n        }\r\n    },\r\n    created() {\r\n        this.getCardData();\r\n    },\r\n    mounted(){\r\n        this.$refs.consume.$on('ConsumeDialogConfirm', form => {\r\n            consume(form).then(res=>{\r\n                    if(res.status==200){\r\n                        this.$message.success('挂失成功');\r\n                        this.getCardData();\r\n                    }else{\r\n                        this.$message.error(\"挂失失败，服务器出现故障\")\r\n                    }\r\n                })\r\n        });\r\n        this.$refs.recharge.$on('RechargeDialogConfirm', form => {\r\n            recharge(form).then(res => {\r\n                this.handleSearch();\r\n            })\r\n        });\r\n    },\r\n    methods: {\r\n        getCardData() {\r\n            selectAllCard({\r\n                pageIndex: this.page.index,\r\n                pageSize: this.page.size\r\n            }).then(res => {\r\n                this.cardData = res.data.list;\r\n                this.page.total = res.data.pageTotal;\r\n            });\r\n        },\r\n        handlePageChange(val) {\r\n            this.page.index = val;\r\n            this.handleSearch();\r\n        },\r\n        handleSearch(){\r\n            selectCardByCondition({\r\n                pageIndex: this.page.index,\r\n                pageSize: this.page.size,\r\n                memberId: this.condition.memberId,\r\n                name: this.condition.name,\r\n                cardId: this.condition.cardId,\r\n            }).then(res => {\r\n                this.cardData = res.data.list;\r\n                this.page.total = res.data.pageTotal;\r\n            });\r\n        },\r\n        handleRecharge(row){\r\n            this.$refs.recharge.show(row);\r\n        },\r\n        handleConsume(row){\r\n            this.$refs.consume.show(row);\r\n        },\r\n        handleLose(row){\r\n            this.$confirm('确定要挂失吗？', '提示', {\r\n                type: 'warning'\r\n            }).then(() => {\r\n                cardLose(row).then(res=>{\r\n                    if(res.status==200){\r\n                        this.$message.success('挂失成功');\r\n                        this.getCardData();\r\n                    }else{\r\n                        this.$message.error(\"挂失失败，服务器出现故障\")\r\n                    }\r\n                });\r\n            }).catch(() => {        \r\n            });\r\n        },\r\n        handleCancel(row){\r\n            this.$confirm('确定要解挂吗？', '提示', {\r\n                type: 'warning'\r\n            }).then(() => {\r\n                cardCancel(row).then(res=>{\r\n                    if(res.status==200){\r\n                        this.$message.success('解挂成功');\r\n                        this.getCardData();\r\n                    }else{\r\n                        this.$message.error(\"解挂失败，服务器出现故障\")\r\n                    }\r\n                })\r\n            }).catch(() => {        \r\n            });\r\n        },\r\n        handleReissue(row){\r\n            this.$confirm('确定要补卡吗？', '提示', {\r\n                type: 'warning'\r\n            }).then(() => {\r\n                console.log(index);\r\n                console.log(row);\r\n            }).catch(() => {        \r\n            });\r\n        },\r\n    },\r\n}\r\n</script>\r\n\r\n<style>\r\n.handle-input {\r\n    width: 200px;\r\n    margin-left: 0px;\r\n    margin-right: 10px;\r\n    margin-top: 4px;\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}